{"version":3,"sources":["../../src/controllers/queryOptions_ctrl.js"],"names":["_","DefaultFlags","MeasurementStateFlags","OpenHistorianQueryOptionsCtrl","$scope","$compile","dataFlags","flags","undefined","merge","return","flagArray","map","Object","keys","key","a","order","Order","sort","b","calculateInitialFlags","flag","type","ctrl","flagVarIncluded","flagVarExcluded","each","index","list","Excluded","Included","padDigits","dec2hex","Normal","number","toString","toUpperCase","digits","Array","Math","max","String","length","join"],"mappings":"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","file":"queryOptions_ctrl.js","sourcesContent":["//******************************************************************************************************\r\n//  queryOptions_ctrl.js - Gbtc\r\n//\r\n//  Copyright ï¿½ 2017, Grid Protection Alliance.  All Rights Reserved.\r\n//\r\n//  Licensed to the Grid Protection Alliance (GPA) under one or more contributor license agreements. See\r\n//  the NOTICE file distributed with this work for additional information regarding copyright ownership.\r\n//  The GPA licenses this file to you under the MIT License (MIT), the \"License\"; you may not use this\r\n//  file except in compliance with the License. You may obtain a copy of the License at:\r\n//\r\n//      http://opensource.org/licenses/MIT\r\n//\r\n//  Unless agreed to in writing, the subject software distributed under the License is distributed on an\r\n//  \"AS-IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. Refer to the\r\n//  License for the specific language governing permissions and limitations.\r\n//\r\n//  Code Modification History:\r\n//  ----------------------------------------------------------------------------------------------------\r\n//  10/31/2017 - Billy Ernest\r\n//       Generated original version of source code.\r\n//\r\n//******************************************************************************************************\r\nimport _ from \"lodash\";\r\nimport { DefaultFlags, MeasurementStateFlags } from './../js/constants.js'\r\n\r\nexport class OpenHistorianQueryOptionsCtrl{\r\n    constructor($scope, $compile) {\r\n        // #region Members\r\n\r\n        this.$scope = $scope;\r\n        this.dataFlags = ($scope.flags == undefined ? DefaultFlags : _.merge(DefaultFlags, $scope.flags));\r\n        this.return = $scope.return;\r\n\r\n        this.flagArray = _.map(Object.keys(this.dataFlags), a => {\r\n            return { key: a, order: this.dataFlags[a].Order };\r\n        }).sort((a, b) => {\r\n            return a.order - b.order;\r\n        });\r\n\r\n        this.calculateInitialFlags();\r\n    // #endregion\r\n    }\r\n\r\n    // #region Methods\r\n    calculateFlags(flag, type) {\r\n        var ctrl = this;\r\n\r\n        var flagVarIncluded = 0;\r\n        var flagVarExcluded = 0;\r\n\r\n        if (flag == 'Select All') {\r\n            _.each(Object.keys(ctrl.dataFlags), function (key, index, list) {\r\n                if (type == 'Included') {\r\n                    ctrl.dataFlags[key].Excluded = false;\r\n                    ctrl.dataFlags[key].Included = true;\r\n                }\r\n                else if (type == 'Excluded') {\r\n                    ctrl.dataFlags[key].Included = false;\r\n                    ctrl.dataFlags[key].Excluded = true;\r\n                }\r\n            });\r\n\r\n            if (type == 'Included') {\r\n                flagVarIncluded = 0xFFFFFFFF;\r\n                flagVarExcluded = 0x00000000;\r\n            }\r\n            else if (type == 'Excluded') {\r\n                flagVarExcluded = 0xFFFFFFFF;\r\n                flagVarIncluded = 0x00000000;\r\n            }\r\n\r\n        }\r\n        else {\r\n            ctrl.dataFlags['Select All'].Included = false;\r\n            ctrl.dataFlags['Select All'].Excluded = false;\r\n\r\n            _.each(Object.keys(ctrl.dataFlags), function (key, index, list) {\r\n                if (key == 'Select All') return;\r\n\r\n                if (type == 'Included') {\r\n                    ctrl.dataFlags[key].Excluded = !ctrl.dataFlags[key].Included\r\n                }\r\n                else if (type == 'Excluded') {\r\n                    ctrl.dataFlags[key].Included = !ctrl.dataFlags[key].Excluded\r\n                }\r\n\r\n\r\n                flagVarIncluded = flagVarIncluded | (ctrl.dataFlags[key].Included ? MeasurementStateFlags[key] : 0);\r\n                flagVarExcluded = flagVarExcluded | (ctrl.dataFlags[key].Excluded ? MeasurementStateFlags[key] : 0);\r\n            });\r\n        }\r\n\r\n        ctrl.return.Included = '0x' + ctrl.padDigits(this.dec2hex(flagVarIncluded), 8);\r\n        ctrl.return.Excluded = '0x' + ctrl.padDigits(this.dec2hex(flagVarExcluded), 8);\r\n        ctrl.return.Normal = ctrl.dataFlags.Normal.Included\r\n        ctrl.$scope.flags = ctrl.dataFlags;\r\n    }\r\n\r\n    calculateInitialFlags(){\r\n        var ctrl = this;\r\n        var flagVarIncluded = 0;\r\n        var flagVarExcluded = 0;\r\n\r\n        _.each(Object.keys(ctrl.dataFlags), function (key, index, list) {\r\n            if (key == 'Select All') return;\r\n\r\n            flagVarIncluded = flagVarIncluded | (ctrl.dataFlags[key].Included ? MeasurementStateFlags[key] : 0);\r\n            flagVarExcluded = flagVarExcluded | (ctrl.dataFlags[key].Excluded ? MeasurementStateFlags[key] : 0);\r\n        });\r\n\r\n        ctrl.return.Included = '0x' + ctrl.padDigits(this.dec2hex(flagVarIncluded), 8);\r\n        ctrl.return.Excluded = '0x' + ctrl.padDigits(this.dec2hex(flagVarExcluded), 8);\r\n\r\n    }\r\n\r\n    dec2hex(number) {\r\n        if (number < 0) {\r\n            number = 0xFFFFFFFF + number + 1;\r\n        }\r\n\r\n        return number.toString(16).toUpperCase();\r\n    }\r\n\r\n    padDigits(number, digits) {\r\n        return Array(Math.max(digits - String(number).length + 1, 0)).join(0) + number;\r\n    }\r\n\r\n    // #endregion\r\n\r\n}\r\n"]}