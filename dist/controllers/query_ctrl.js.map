{"version":3,"sources":["../../src/controllers/query_ctrl.js"],"names":["QueryCtrl","_","OpenHistorianDataSourceQueryCtrl","$scope","$injector","uiSegmentSrv","templateSrv","scope","ctrl","target","textEditor","segments","undefined","map","a","newSegment","value","text","expandable","queryTypes","queryType","wheres","type","newOperator","newCondition","functionSegments","topNSegment","functions","orderBys","elementSegment","newPlusButton","whereSegment","filterSegment","orderBySegment","functionSegment","phasorSegment","phasorSegments","typingTimer","phasorList","buildFunctionArray","setTargetWithQuery","setTargetWithPhasors","setTargetWithElements","length","filter","topn","where","each","element","index","list","orderby","query","panelCtrl","refresh","join","phasors","phasor","find","o","m_Item1","push","m_Item2","m_Item3","option","event","datasource","metricFindQuery","then","altSegments","data","item","sort","b","unshift","x","segment","plusButton","html","targets","split","splice","phasorFindQuery","JSON","parse","stringify","q","when","newOperators","whereFindQuery","newFake","filterFindQuery","orderByFindQuery","orderBy","array","Object","keys","functionList","slice","func","remove","funcSeg","Function","l","fi","findIndex","Parameters","Type","Index","Default","newElement","operator","param","i","j","d","toString","Description","clearTimeout","setTimeout","functionValueChanged","focus","templateUrl","Set","Slice","Average","Minimum","Maximum","Total","Range","Count","Distinct","AbsoluteValute","Add","Multiply","Round","Floor","Ceiling","Truncate","StandardDeviation","Median","Mode","Top","Bottom","Random","First","Last","Percentile","Difference","TimeDifference","Derivative","TimeIntegration","Interval","IncludeRange","ExcludeRange","FilterNaN","UnwrapAngle","WrapAngle","Label"],"mappings":"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","file":"query_ctrl.js","sourcesContent":["import { QueryCtrl } from 'app/plugins/sdk'\r\nimport './../css/query-editor.css!'\r\nimport _ from 'lodash'\r\n\r\nexport class OpenHistorianDataSourceQueryCtrl extends QueryCtrl{\r\n    constructor($scope, $injector, uiSegmentSrv, templateSrv) {\r\n        super($scope, $injector);\r\n\r\n\r\n        this.scope = $scope;\r\n        var ctrl = this;\r\n        this.uiSegmentSrv = uiSegmentSrv;\r\n        this.target.target = '';\r\n        this.target.textEditor = false;\r\n        this.segments = (this.target.segments == undefined ? [] : this.target.segments.map(function (a) { return ctrl.uiSegmentSrv.newSegment({ value: a.text, expandable: true }) }));\r\n        this.queryTypes = [\r\n            \"Element List\", \"Filter Expression\", \"Phasor List\"\r\n        ];\r\n        this.queryType = (this.target.queryType == undefined ? \"Element List\" : this.target.queryType);\r\n        this.wheres = (this.target.wheres == undefined ? [] : this.target.wheres.map(function (a) {\r\n            if (a.type == 'operator') return ctrl.uiSegmentSrv.newOperator(a.text);\r\n            else if (a.type == 'condition') return ctrl.uiSegmentSrv.newCondition(a.text);\r\n            else return ctrl.uiSegmentSrv.newSegment(a.value);\r\n        }));\r\n        this.functionSegments = (this.target.functionSegments == undefined ? [] : this.target.functionSegments);\r\n        this.topNSegment = (this.target.topNSegment == undefined ? null : this.target.topNSegment);\r\n        this.functions = [];\r\n        this.orderBys = (this.target.orderBys == undefined ? [] : this.target.orderBys.map(function (a)\r\n        {\r\n            if (a.type == 'condition')\r\n                return ctrl.uiSegmentSrv.newCondition(a.value);\r\n            else\r\n                return ctrl.uiSegmentSrv.newSegment(a.value);\r\n        }));\r\n        this.elementSegment = this.uiSegmentSrv.newPlusButton();\r\n        this.whereSegment = this.uiSegmentSrv.newPlusButton();\r\n        this.filterSegment = (this.target.filterSegment == undefined ? this.uiSegmentSrv.newSegment('ActiveMeasurement') : this.uiSegmentSrv.newSegment(this.target.filterSegment.value));\r\n        this.orderBySegment =  this.uiSegmentSrv.newPlusButton();\r\n        this.functionSegment = this.uiSegmentSrv.newPlusButton();\r\n\r\n        this.phasorSegment = this.uiSegmentSrv.newPlusButton();\r\n        this.phasorSegments = (this.target.phasorSegments == undefined ? [] : this.target.phasorSegments.map(function (a) { return ctrl.uiSegmentSrv.newSegment({ value: a.text, expandable: true }) }));\r\n        this.typingTimer;\r\n\r\n        this.phasorList = (this.target.phasorList == undefined ? [] : this.target.phasorList);\r\n\r\n        this.buildFunctionArray();\r\n\r\n        if (this.queryType == 'Filter Expression')\r\n            this.setTargetWithQuery();\r\n        else if (this.queryType == 'Phasor List')\r\n            this.setTargetWithPhasors()\r\n        else\r\n            this.setTargetWithElements()\r\n  }\r\n\r\n  // #region Target Compilation\r\n    setTargetWithQuery() {\r\n      if (this.wheres.length == 0) return;\r\n      var filter = this.filterSegment.value + ' ';\r\n      var topn = (this.topNSegment ? 'TOP ' + this.topNSegment + ' ' : '');\r\n      var where = 'WHERE ';\r\n      \r\n      _.each(this.wheres, function (element, index, list) {\r\n            where += element.value + ' '\r\n      });\r\n\r\n      var orderby = '';\r\n      _.each(this.orderBys, function (element, index, list) {\r\n          orderby += (index == 0 ? 'ORDER BY ' : '') + element.value + (element.type == 'condition' && index < list.length - 1? ',' : '') +' ';\r\n      });\r\n\r\n      var query = 'FILTER ' + topn + filter + where + orderby;\r\n      var functions = '';\r\n\r\n      _.each(this.functions, function (element, index, list) {\r\n          if (element.value == 'QUERY') functions += query;\r\n          else functions += element.value;\r\n      });\r\n\r\n      this.target.target = (functions != \"\" ? functions : query);\r\n      this.target.topNSegment = this.topNSegment;\r\n      this.target.filterSegment = this.filterSegment;\r\n      this.target.orderBys = this.orderBys;\r\n      this.target.wheres = this.wheres;\r\n      this.target.functionSegments = this.functionSegments;\r\n      this.target.queryType = this.queryType;\r\n      this.panelCtrl.refresh()\r\n\r\n  }\r\n\r\n  setTargetWithElements() {\r\n      var functions = '';\r\n      var ctrl = this;\r\n      _.each(this.functions, function (element, index, list) {\r\n          if (element.value == 'QUERY') functions += ctrl.segments.map(function (a) { return a.value }).join(';');\r\n          else functions += element.value;\r\n      });\r\n\r\n      this.target.target = (functions != \"\" ? functions : this.segments.map(function (a) { return a.value }).join(';'));\r\n\r\n      this.target.functionSegments = this.functionSegments;\r\n      this.target.segments = this.segments;\r\n      this.target.queryType = this.queryType;\r\n      this.panelCtrl.refresh()\r\n\r\n  }\r\n\r\n  setTargetWithPhasors() {\r\n      var ctrl = this;\r\n\r\n      var phasors = [];\r\n      _.each(ctrl.phasorSegments, function (element, index, list) {\r\n          var phasor = _.find(ctrl.phasorList, function (o) { return o.text.m_Item1 == element.value });\r\n          phasors.push(phasor.text.m_Item2 + ';' + phasor.text.m_Item3); \r\n      });\r\n\r\n      ctrl.target.target = phasors.join(';');\r\n\r\n      ctrl.target.phasorSegments = this.phasorSegments;\r\n      ctrl.target.phasorList = this.phasorList;\r\n      ctrl.target.queryType = this.queryType;\r\n      ctrl.panelCtrl.refresh()\r\n\r\n  }\r\n\r\n  // #endregion\r\n\r\n  onChangeInternal() {\r\n    this.panelCtrl.refresh(); // Asks the panel to refresh data.\r\n  }\r\n\r\n  toggleEditorMode(){\r\n    this.target.textEditor = !this.target.textEditor;\r\n  }\r\n\r\n  textEditorChanged(){\r\n      this.panelCtrl.refresh(); // Asks the panel to refresh data.\r\n  }\r\n\r\n  // used to change the query type from element list to filter expression\r\n  changeQueryType() {\r\n      this.target.target = '';\r\n      this.segments = [];\r\n      this.wheres = [];\r\n      this.functions = [];\r\n      this.functionSegments = [];\r\n      this.orderBys = [];\r\n      this.topNSegment = '';\r\n      this.elementSegment = this.uiSegmentSrv.newPlusButton();\r\n      this.whereSegment = this.uiSegmentSrv.newPlusButton();\r\n      this.filterSegment = this.uiSegmentSrv.newSegment('ActiveMeasurements');\r\n      this.orderBySegment = this.uiSegmentSrv.newPlusButton();\r\n      this.functionSegment = this.uiSegmentSrv.newPlusButton();\r\n      this.panelCtrl.refresh();\r\n  }\r\n\r\n\r\n  // #region Elements\r\n  getElementSegmentsToEdit() {\r\n      var ctrl = this;\r\n      var option = null;\r\n      if (event.target.value != \"\") option = event.target.value; \r\n\r\n    var ctrl = this;\r\n    return this.datasource.metricFindQuery(option).then( data => {\r\n        var altSegments = _.map(data, item => {\r\n            return ctrl.uiSegmentSrv.newSegment({value: item.text, expandable: item.expandable})\r\n        });\r\n        altSegments.sort((a,b)=>{           \r\n          if(a.value < b.value)\r\n            return -1;\r\n          if(a.value > b.value)\r\n            return 1;\r\n          return 0;\r\n        });\r\n        altSegments.unshift(ctrl.uiSegmentSrv.newSegment('-REMOVE-'));\r\n\r\n        return _.filter(altSegments, segment => {\r\n          return _.find(ctrl.segments, x => {\r\n            return x.value == segment.value\r\n          }) == undefined;\r\n        });\r\n    });\r\n    \r\n  }\r\n\r\n  getElementSegmentsToAddNew () {\r\n        var ctrl = this;\r\n        var option = null;\r\n        if (event.target.value != \"\") option = event.target.value; \r\n        return this.datasource.metricFindQuery(option).then( data => {\r\n            var altSegments = _.map(data, item => {\r\n                return ctrl.uiSegmentSrv.newSegment({value: item.text, expandable: item.expandable})\r\n            });\r\n            altSegments.sort((a,b)=>{ \r\n                if(a.value < b.value)\r\n                return -1;\r\n                if(a.value > b.value)\r\n                return 1;\r\n                return 0;\r\n            });\r\n\r\n            return _.filter(altSegments, segment => {\r\n                return _.find(ctrl.segments, x => {\r\n                return x.value == segment.value\r\n                }) == undefined;\r\n            });\r\n        });\r\n    \r\n  }\r\n\r\n\r\n  addElementSegment(){\r\n          // if value is not empty, add new attribute segment\r\n    if (event.target.text != null) {\r\n        this.segments.push(this.uiSegmentSrv.newSegment({ value: event.target.text, expandable: true}))\r\n      this.setTargetWithElements()\r\n    }\r\n\r\n    // reset the + button\r\n    var plusButton = this.uiSegmentSrv.newPlusButton()\r\n    this.elementSegment.value = plusButton.value\r\n    this.elementSegment.html = plusButton.html\r\n    this.panelCtrl.refresh()\r\n\r\n  }\r\n\r\n  segmentValueChanged(segment, index) {\r\n    if(segment.value== \"-REMOVE-\"){\r\n      var targets = this.target.target.split(';');\r\n      this.segments.splice(index, 1);\r\n      targets.splice(index, 1);\r\n      this.target.target = targets.join(';');\r\n    }\r\n    else{\r\n      var targets = this.target.target.split(';');\r\n      this.segments[index] = segment;\r\n      targets[index] = segment.value;\r\n      this.target.target = targets.join(';');\r\n    }\r\n    \r\n    \r\n  }\r\n  // #endregion\r\n\r\n  // #region Phasors\r\n  getPhasorSegmentsToEdit() {\r\n      var ctrl = this;\r\n      var option = null;\r\n      if (event.target.value != \"\") option = event.target.value;\r\n\r\n      var ctrl = this;\r\n      return this.datasource.phasorFindQuery(option).then(data => {\r\n          ctrl.phasorList = JSON.parse(JSON.stringify(data));\r\n\r\n          var altSegments = _.map(data, item => {\r\n              return ctrl.uiSegmentSrv.newSegment({ value: item.text.m_Item1, expandable: item.expandable});\r\n          });\r\n          altSegments.sort((a, b) => {\r\n              if (a.value < b.value)\r\n                  return -1;\r\n              if (a.value > b.value)\r\n                  return 1;\r\n              return 0;\r\n          });\r\n\r\n\r\n          altSegments.unshift(ctrl.uiSegmentSrv.newSegment('-REMOVE-'));\r\n\r\n          return _.filter(altSegments, segment => {\r\n              return _.find(ctrl.phasorSegments, x => {\r\n                  return x.value == segment.value\r\n              }) == undefined;\r\n          });\r\n\r\n      });\r\n\r\n  }\r\n\r\n  getPhasorSegmentsToAddNew() {\r\n      var ctrl = this;\r\n      var option = null;\r\n\r\n\r\n      if (event.target.value != \"\") option = event.target.value;\r\n      return this.datasource.phasorFindQuery(option).then(data => {\r\n          ctrl.phasorList = JSON.parse(JSON.stringify(data));\r\n\r\n          var altSegments = _.map(data, item => {\r\n              return ctrl.uiSegmentSrv.newSegment({ value: item.text.m_Item1, expandable: item.expandable });\r\n          });\r\n          altSegments.sort((a, b) => {\r\n              if (a.value < b.value)\r\n                  return -1;\r\n              if (a.value > b.value)\r\n                  return 1;\r\n              return 0;\r\n          });\r\n\r\n\r\n          return _.filter(altSegments, segment => {\r\n              return _.find(ctrl.phasorSegments, x => {\r\n                  return x.value == segment.value\r\n              }) == undefined;\r\n          });\r\n      });\r\n\r\n  }\r\n\r\n\r\n  addPhasorSegment() {\r\n      // if value is not empty, add new attribute segment\r\n      if (event.target.text != null) {\r\n          this.phasorSegments.push(this.uiSegmentSrv.newSegment({ value: event.target.text, expandable: true }))\r\n          this.setTargetWithPhasors()\r\n      }\r\n\r\n      // reset the + button\r\n      var plusButton = this.uiSegmentSrv.newPlusButton()\r\n      this.phasorSegment.value = plusButton.value\r\n      this.phasorSegment.html = plusButton.html\r\n      this.panelCtrl.refresh()\r\n\r\n  }\r\n\r\n  phasorValueChanged(segment, index) {\r\n      if (segment.value == \"-REMOVE-\") {\r\n          var targets = this.target.target.split(';');\r\n          this.phasorSegments.splice(index, 1);\r\n          targets.splice(index, 1);\r\n          this.target.target = targets.join(';');\r\n      }\r\n      else {\r\n          var targets = this.target.target.split(';');\r\n          this.phasorSegments[index] = segment;\r\n          targets[index] = segment.value;\r\n          this.target.target = targets.join(';');\r\n      }\r\n\r\n\r\n  }\r\n  // #endregion\r\n\r\n  // #region TOP N\r\n  topNValueChanged() {\r\n      this.setTargetWithQuery();\r\n  }\r\n  // #endregion\r\n\r\n  // #region Wheres\r\n  getWheresToEdit(where, index) {\r\n\r\n      if (where.type === 'operator') {\r\n          return this.datasource.q.when(this.uiSegmentSrv.newOperators(['=', '<>', '<', '<=', '>', '>=', 'LIKE', 'NOT LIKE', 'IN', 'NOT IN', 'IS', 'IS NOT']));\r\n      }\r\n      else if (where.type === 'value') {\r\n          return this.datasource.q.when(null);\r\n      }\r\n      else if (where.type === 'condition') {\r\n          return this.datasource.q.when([this.uiSegmentSrv.newCondition('AND'), this.uiSegmentSrv.newCondition('OR')]);\r\n      }\r\n      else {\r\n          return this.datasource.whereFindQuery(this.filterSegment.value).then(data => {\r\n              var altSegments = _.map(data, item => {\r\n                  return this.uiSegmentSrv.newSegment({ value: item.text, expandable: item.expandable })\r\n              });\r\n              altSegments.sort((a, b) => {\r\n                  if (a.value < b.value)\r\n                      return -1;\r\n                  if (a.value > b.value)\r\n                      return 1;\r\n                  return 0;\r\n              });\r\n              altSegments.unshift(this.uiSegmentSrv.newSegment('-REMOVE-'));\r\n              return _.filter(altSegments, segment => {\r\n                  return _.find(this.segments, x => {\r\n                      return x.value == segment.value\r\n                  }) == undefined;\r\n              });\r\n          });\r\n      }\r\n\r\n  }\r\n\r\n  whereValueChanged(where, index) {\r\n\r\n      if (where.value == \"-REMOVE-\") {\r\n          if (index == 0 && this.wheres.length > 3 && this.wheres[index + 3].type == 'condition') \r\n              this.wheres.splice(index, 4)\r\n          else if (index > 0 && this.wheres[index - 1].type == 'condition')\r\n              this.wheres.splice(index - 1, 4)\r\n          else\r\n              this.wheres.splice(index, 3)\r\n      }\r\n\r\n      if (where.type == 'operator')\r\n          this.wheres[index] = this.uiSegmentSrv.newOperator(where.value)\r\n      else if (where.type == 'condition')\r\n          this.wheres[index] = this.uiSegmentSrv.newCondition(where.value)\r\n\r\n      this.setTargetWithQuery();\r\n  }\r\n\r\n  getWheresToAddNew() {\r\n      var ctrl = this;\r\n      return this.datasource.whereFindQuery(ctrl.filterSegment.value).then(data => {\r\n          var altSegments = _.map(data, item => {\r\n              return ctrl.uiSegmentSrv.newSegment({ value: item.text, expandable: item.expandable })\r\n          });\r\n          altSegments.sort((a, b) => {\r\n              if (a.value < b.value)\r\n                  return -1;\r\n              if (a.value > b.value)\r\n                  return 1;\r\n              return 0;\r\n          });\r\n          return _.filter(altSegments, segment => {\r\n              return _.find(ctrl.segments, x => {\r\n                  return x.value == segment.value\r\n              }) == undefined;\r\n          });\r\n      });\r\n  }\r\n\r\n  addWhere() {\r\n      if (this.wheres.length > 0) \r\n          this.wheres.push(this.uiSegmentSrv.newCondition('AND'));\r\n\r\n      this.wheres.push(this.uiSegmentSrv.newSegment(event.target.text));\r\n      this.wheres.push(this.uiSegmentSrv.newOperator('NOT LIKE'));\r\n      this.wheres.push(this.uiSegmentSrv.newFake(\"''\", 'value', 'query-segment-value'));\r\n\r\n      // reset the + button\r\n      var plusButton = this.uiSegmentSrv.newPlusButton()\r\n      this.whereSegment.value = plusButton.value\r\n      this.whereSegment.html = plusButton.html\r\n      this.setTargetWithQuery();\r\n\r\n  }\r\n\r\n  // #endregion\r\n\r\n  // #region Filters\r\n  getFilterToEdit() {\r\n      var ctrl = this;\r\n      return this.datasource.filterFindQuery().then(data => {\r\n          var altSegments = _.map(data, item => {\r\n              return ctrl.uiSegmentSrv.newSegment({ value: item.text, expandable: item.expandable })\r\n          });\r\n          altSegments.sort((a, b) => {\r\n              if (a.value < b.value)\r\n                  return -1;\r\n              if (a.value > b.value)\r\n                  return 1;\r\n              return 0;\r\n          });\r\n\r\n          return _.filter(altSegments, segment => {\r\n              return _.find(ctrl.segments, x => {\r\n                  return x.value == segment.value\r\n              }) == undefined;\r\n          });\r\n      });\r\n  }\r\n\r\n  filterValueChanged() {\r\n      //this.target.policy = this.topNSegment;\r\n      this.orderBySegment = this.uiSegmentSrv.newPlusButton();\r\n      this.wheres = [];\r\n      this.setTargetWithQuery();\r\n\r\n      this.panelCtrl.refresh();\r\n  }\r\n\r\n  // #endregion\r\n\r\n  // #region OrderBys\r\n  getOrderBysToAddNew() {\r\n      var ctrl = this;\r\n      return this.datasource.orderByFindQuery(ctrl.filterSegment.value).then(data => {\r\n          var altSegments = _.map(data, item => {\r\n              return ctrl.uiSegmentSrv.newSegment({ value: item.text, expandable: item.expandable })\r\n          });\r\n          altSegments.sort((a, b) => {\r\n              if (a.value < b.value)\r\n                  return -1;\r\n              if (a.value > b.value)\r\n                  return 1;\r\n              return 0;\r\n          });\r\n\r\n          return _.filter(altSegments, segment => {\r\n              return _.find(ctrl.orderBys, x => {\r\n                  return x.value == segment.value\r\n              }) == undefined;\r\n          });\r\n      });\r\n  }\r\n\r\n  getOrderBysToEdit(orderBy) {\r\n      var ctrl = this;\r\n      if (orderBy.type == 'condition') return this.datasource.q.when([this.uiSegmentSrv.newCondition('ASC'), this.uiSegmentSrv.newCondition('DESC')]);\r\n      if (orderBy.type == 'condition') return this.datasource.q.when([this.uiSegmentSrv.newCondition('ASC'), this.uiSegmentSrv.newCondition('DESC')]);\r\n\r\n      return this.datasource.orderByFindQuery(ctrl.filterSegment.value).then(data => {\r\n          var altSegments = _.map(data, item => {\r\n              return ctrl.uiSegmentSrv.newSegment({ value: item.text, expandable: item.expandable })\r\n          });\r\n          altSegments.sort((a, b) => {\r\n              if (a.value < b.value)\r\n                  return -1;\r\n              if (a.value > b.value)\r\n                  return 1;\r\n              return 0;\r\n          });\r\n\r\n          if (orderBy.type !== 'plus-button')\r\n              altSegments.unshift(this.uiSegmentSrv.newSegment('-REMOVE-'));\r\n\r\n          return _.filter(altSegments, segment => {\r\n              return _.find(ctrl.orderBys, x => {\r\n                  return x.value == segment.value\r\n              }) == undefined;\r\n          });\r\n      });\r\n  }\r\n\r\n  addOrderBy() {\r\n      this.orderBys.push(this.uiSegmentSrv.newSegment(event.target.text));\r\n      this.orderBys.push(this.uiSegmentSrv.newCondition('ASC'));\r\n\r\n      // reset the + button\r\n      var plusButton = this.uiSegmentSrv.newPlusButton()\r\n      this.orderBySegment.value = plusButton.value\r\n      this.orderBySegment.html = plusButton.html\r\n\r\n      this.setTargetWithQuery();\r\n\r\n      if (this.queryType == 'Filter Expression')\r\n          this.setTargetWithQuery();\r\n      else\r\n          this.setTargetWithElements()\r\n\r\n  }\r\n\r\n\r\n  orderByValueChanged(orderBy, index) {\r\n      if (event.target.text == \"-REMOVE-\")\r\n          this.orderBys.splice(index, 2);\r\n      else\r\n      {\r\n          if (orderBy.type == 'condition')\r\n              this.orderBys[index] = this.uiSegmentSrv.newCondition(event.target.text);\r\n          else\r\n              this.orderBys[index] = this.uiSegmentSrv.newSegment(event.target.text);\r\n\r\n      }\r\n      this.setTargetWithQuery();\r\n\r\n  }\r\n\r\n  // #endregion\r\n\r\n  // #region Functions\r\n  getFunctionsToAddNew() {\r\n      var ctrl = this;\r\n      var array = []\r\n      _.each(Object.keys(functionList), function (element, index, list) {\r\n          array.push(ctrl.uiSegmentSrv.newSegment(element));\r\n      });\r\n\r\n      if (this.functions.length == 0) array = array.slice(2,array.length);\r\n\r\n      return this.datasource.q.when(_.filter( array, segment => {\r\n          return _.find(this.functions, x => {\r\n              return x.value == segment.value;\r\n          }) == undefined;\r\n      }));\r\n  }\r\n\r\n  getFunctionsToEdit(func, index) {\r\n      var ctrl = this;\r\n      var remove = [this.uiSegmentSrv.newSegment('-REMOVE-')];\r\n      if (func.type == 'Operator') return this.datasource.q.when();\r\n      else if (func.value == 'Set') return this.datasource.q.when(remove)\r\n\r\n      return this.datasource.q.when(remove);\r\n  }\r\n\r\n  functionValueChanged(func, index) {\r\n      var funcSeg = functionList[func.Function];\r\n\r\n      if (func.value == \"-REMOVE-\") {\r\n          var l = 1;\r\n          var fi = _.findIndex(this.functionSegments, function (segment) { return segment.Function == func.Function });\r\n          if (func.Function == 'Slice')\r\n              this.functionSegments[fi + 1].Parameters = this.functionSegments[fi + 1].Parameters.slice(1, this.functionSegments[fi + 1].Parameters.length);\r\n          else if (fi > 0 && (this.functionSegments[fi - 1].Function == 'Set' || this.functionSegments[fi - 1].Function == 'Slice')) {\r\n              --fi;\r\n                ++l;\r\n          }\r\n\r\n          this.functionSegments.splice(fi,l);\r\n      }\r\n      else if (func.Type != 'Function') {\r\n          var fi = _.findIndex(this.functionSegments, function (segment) { return segment.Function == func.Function });\r\n          this.functionSegments[fi].Parameters[func.Index].Default = func.value;\r\n      }\r\n\r\n      this.buildFunctionArray()\r\n\r\n      if (this.queryType == 'Filter Expression')\r\n          this.setTargetWithQuery();\r\n      else\r\n          this.setTargetWithElements() \r\n\r\n  }\r\n\r\n  addFunctionSegment() {\r\n      var func = functionList[event.target.text];\r\n\r\n      if (func.Function == 'Slice') {\r\n          this.functionSegments[0].Parameters.unshift(func.Parameters[0])\r\n      }\r\n\r\n      this.functionSegments.unshift(JSON.parse(JSON.stringify(func)));\r\n      this.buildFunctionArray();\r\n\r\n      // reset the + button\r\n      var plusButton = this.uiSegmentSrv.newPlusButton()\r\n      this.functionSegment.value = plusButton.value\r\n      this.functionSegment.html = plusButton.html\r\n\r\n      if (this.queryType == 'Filter Expression')\r\n          this.setTargetWithQuery();\r\n      else\r\n          this.setTargetWithElements()\r\n  }\r\n\r\n  buildFunctionArray() {\r\n      var ctrl = this;\r\n      ctrl.functions = [];\r\n\r\n      if (this.functionSegments.length == 0) return;\r\n\r\n      _.each(ctrl.functionSegments, function (element, index, list) {\r\n          var newElement = ctrl.uiSegmentSrv.newSegment(element.Function)\r\n          newElement.Type = 'Function';\r\n          newElement.Function = element.Function;\r\n\r\n          ctrl.functions.push(newElement)\r\n\r\n          if (newElement.value == 'Set' || newElement.value == 'Slice') return;\r\n\r\n          var operator = ctrl.uiSegmentSrv.newOperator('(');\r\n          operator.Type = 'Operator';\r\n          ctrl.functions.push(operator);\r\n\r\n          _.each(element.Parameters, function (param, i, j) {\r\n              var d = ctrl.uiSegmentSrv.newFake(param.Default.toString());\r\n              d.Type = param.Type;\r\n              d.Function = element.Function;\r\n              d.Description = param.Description;\r\n              d.Index = i;\r\n              ctrl.functions.push(d);\r\n\r\n              var operator = ctrl.uiSegmentSrv.newOperator(',');\r\n              operator.Type = 'Operator';\r\n              ctrl.functions.push(operator);\r\n          })\r\n\r\n      });\r\n\r\n      var query = ctrl.uiSegmentSrv.newCondition('QUERY');\r\n      query.Type = 'Query';\r\n      ctrl.functions.push(query);\r\n\r\n      for (var i in ctrl.functionSegments) {\r\n          if (ctrl.functionSegments[i].Function != 'Set' && ctrl.functionSegments[i].Function != 'Slice') {\r\n              var operator = ctrl.uiSegmentSrv.newOperator(')');\r\n              operator.Type = 'Operator';\r\n              ctrl.functions.push(operator);\r\n          }\r\n\r\n      }\r\n\r\n  }\r\n\r\n  getBooleans() {\r\n      var array = [\r\n          this.uiSegmentSrv.newSegment('true'),\r\n          this.uiSegmentSrv.newSegment('false')\r\n      ];\r\n      return this.datasource.q.when(array);\r\n  }\r\n\r\n  getAngleUnits() {\r\n      var array = [\r\n          this.uiSegmentSrv.newSegment('Degrees'),\r\n          this.uiSegmentSrv.newSegment('Radians'),\r\n          this.uiSegmentSrv.newSegment('Grads'),\r\n          this.uiSegmentSrv.newSegment('ArcMinutes'),\r\n          this.uiSegmentSrv.newSegment('ArcSeconds'),\r\n          this.uiSegmentSrv.newSegment('AngularMil')\r\n      ];\r\n      return this.datasource.q.when(array);\r\n  }\r\n\r\n  getTimeSelect() {\r\n      var array = [\r\n          this.uiSegmentSrv.newSegment('Weeks'),\r\n          this.uiSegmentSrv.newSegment('Days'),\r\n          this.uiSegmentSrv.newSegment('Hours'),\r\n          this.uiSegmentSrv.newSegment('Minutes'),\r\n          this.uiSegmentSrv.newSegment('Seconds'),\r\n          this.uiSegmentSrv.newSegment('Milliseconds'),\r\n          this.uiSegmentSrv.newSegment('Microseconds'),\r\n          this.uiSegmentSrv.newSegment('Nanoseconds'),\r\n          this.uiSegmentSrv.newSegment('Ticks'),\r\n          this.uiSegmentSrv.newSegment('PlanckTime'),\r\n          this.uiSegmentSrv.newSegment('AtomicUnitsOfTime'),\r\n          this.uiSegmentSrv.newSegment('Ke')\r\n      ];\r\n      return this.datasource.q.when(array);\r\n  }\r\n\r\n  inputChange(func, index) {\r\n      var ctrl = this;\r\n      clearTimeout(this.typingTimer);\r\n      this.typingTimer = setTimeout(function () { ctrl.functionValueChanged(func, index) }, 1000);\r\n      event.target.focus()\r\n      \r\n  }\r\n\r\n  // #endregion\r\n\r\n}\r\n\r\nOpenHistorianDataSourceQueryCtrl.templateUrl = 'partial/query.editor.html';\r\n\r\nconst functionList = {\r\n    Set: { Function: 'Set', Parameters: [] },\r\n    Slice: { Function: 'Slice', Parameters: [{ Default: 1, Type: 'double', Description: 'A floating-point value that must be greater than or equal to zero that represents the desired time tolerance, in seconds, for the time slice.' }] },\r\n    Average: { Function: 'Average', Parameters: [] },\r\n    Minimum: { Function: 'Minimum', Parameters: [] },\r\n    Maximum: { Function: 'Maximum', Parameters: [] },\r\n    Total: { Function: 'Total', Parameters: [] },\r\n    Range: { Function: 'Range', Parameters: [] },\r\n    Count: { Function: 'Count', Parameters: [] },\r\n    Distinct: { Function: 'Distinct', Parameters: [] },\r\n    AbsoluteValute: { Function: 'AbsoluteValue', Parameters: [] },\r\n    Add: { Function: 'Add', Parameters: [{ Default: 0, Type: 'double', Description: 'A floating point value representing an additive offset to be applied to each value the source series.' }] },\r\n    Multiply: { Function: 'Multiply', Parameters: [{ Default: 1, Type: 'double', Description: 'A floating point value representing an additive offset to be applied to each value the source series.' }] },\r\n    Round: { Function: 'Round', Parameters: [{ Default: 0, Type: 'double', Description: 'A positive integer value representing the number of decimal places in the return value - defaults to 0.' }] },\r\n    Floor: { Function: 'Floor', Parameters: [] },\r\n    Ceiling: { Function: 'Ceiling', Parameters: [] },\r\n    Truncate: { Function: 'Truncate', Parameters: [] },\r\n    StandardDeviation: { Function: 'StandardDeviation', Parameters: [{ Default: false, Type: 'boolean', Description: 'A boolean flag representing if the sample based calculation should be used - defaults to false, which means the population based calculation should be used.' }] },\r\n    Median: { Function: 'Median', Parameters: [] },\r\n    Mode: { Function: 'Mode', Parameters: [] },\r\n    Top: { Function: 'Top', Parameters: [{ Default: '100%', Type: 'string', Description: 'A positive integer value, representing a total, that is greater than zero - or - a floating point value, suffixed with \\' %\\' representing a percentage, that must range from greater than 0 to less than or equal to 100.' }, { Default: true, Type: 'boolean', Description: 'A boolean flag representing if time in dataset should be normalized - defaults to true.' }] },\r\n    Bottom: { Function: 'Bottom', Parameters: [{ Default: '100%', Type: 'string', Description: 'A positive integer value, representing a total, that is greater than zero - or - a floating point value, suffixed with \\' %\\' representing a percentage, that must range from greater than 0 to less than or equal to 100.' }, { Default: true, Type: 'boolean', Description: 'A boolean flag representing if time in dataset should be normalized - defaults to true.' }] },\r\n    Random: { Function: 'Random', Parameters: [{ Default: '100%', Type: 'string', Description: 'A positive integer value, representing a total, that is greater than zero - or - a floating point value, suffixed with \\' %\\' representing a percentage, that must range from greater than 0 to less than or equal to 100.' }, { Default: true, Type: 'boolean', Description: 'A boolean flag representing if time in dataset should be normalized - defaults to true.' }] },\r\n    First: { Function: 'First', Parameters: [{ Default: '1', Type: 'string', Description: 'A positive integer value, representing a total, that is greater than zero - or - a floating point value, suffixed with \\' %\\' representing a percentage, that must range from greater than 0 to less than or equal to 100 - defaults to 1.' }] },\r\n    Last: { Function: 'Last', Parameters: [{ Default: '1', Type: 'string', Description: 'A positive integer value, representing a total, that is greater than zero - or - a floating point value, suffixed with \\' %\\' representing a percentage, that must range from greater than 0 to less than or equal to 100 - defaults to 1.' }] },\r\n    Percentile: { Function: 'Percentile', Parameters: [{ Default: '100%', Type: 'string', Description: 'A floating point value, representing a percentage, that must range from 0 to 100.' }] },\r\n    Difference: { Function: 'Difference', Parameters: [] },\r\n    TimeDifference: { Function: 'TimeDifference', Parameters: [{ Default: 'Seconds', Type: 'time', Description: 'Specifies the type of time units and must be one of the following: Seconds, Nanoseconds, Microseconds, Milliseconds, Minutes, Hours, Days, Weeks, Ke (i.e., traditional Chinese unit of decimal time), Ticks (i.e., 100-nanosecond intervals), PlanckTime or AtomicUnitsOfTime - defaults to Seconds.' }] },\r\n    Derivative: { Function: 'Derivative', Parameters: [{ Default: 'Seconds', Type: 'time', Description: 'Specifies the type of time units and must be one of the following: Seconds, Nanoseconds, Microseconds, Milliseconds, Minutes, Hours, Days, Weeks, Ke (i.e., traditional Chinese unit of decimal time), Ticks (i.e., 100-nanosecond intervals), PlanckTime or AtomicUnitsOfTime - defaults to Seconds.' }] },\r\n    TimeIntegration: { Function: 'TimeIntegration', Parameters: [{ Default: 'Hours', Type: 'time', Description: 'Specifies the type of time units and must be one of the following: Seconds, Nanoseconds, Microseconds, Milliseconds, Minutes, Hours, Days, Weeks, Ke (i.e., traditional Chinese unit of decimal time), Ticks (i.e., 100-nanosecond intervals), PlanckTime or AtomicUnitsOfTime - defaults to Hours.' }] },\r\n    Interval: { Function: 'Interval', Parameters: [{ Default: 0, Type: 'double', Description: 'A floating-point value that must be greater than or equal to zero that represents the desired time interval, in time units, for the returned data. ' }, { Default: 'Seconds', Type: 'time', Description: 'Specifies the type of time units and must be one of the following: Seconds, Nanoseconds, Microseconds, Milliseconds, Minutes, Hours, Days, Weeks, Ke (i.e., traditional Chinese unit of decimal time), Ticks (i.e., 100-nanosecond intervals), PlanckTime or AtomicUnitsOfTime - defaults to Seconds.' }] },\r\n    IncludeRange: { Function: 'IncludeRange', Parameters: [{ Default: 0, Type: 'double', Description: 'Floating-point number that represents the low range of values allowed in the return series.' }, { Default: 0, Type: 'double', Description: 'Floating-point number that represents the high range of values allowed in the return series.' }, { Default: false, Type: 'boolean', Description: 'A boolean flag that determines if range values are inclusive, i.e., allowed values are >= low and <= high - defaults to false, which means values are exclusive, i.e., allowed values are > low and < high.' }, { Default: false, Type: 'boolean', Description: 'A boolean flag - when four parameters are provided, third parameter determines if low value is inclusive and forth parameter determines if high value is inclusive.' }] },\r\n    ExcludeRange: { Function: 'ExcludeRange', Parameters: [{ Default: 0, Type: 'double', Description: 'Floating-point number that represents the low range of values allowed in the return series.' }, { Default: 0, Type: 'double', Description: 'Floating-point number that represents the high range of values allowed in the return series.' }, { Default: false, Type: 'boolean', Description: 'A boolean flag that determines if range values are inclusive, i.e., allowed values are >= low and <= high - defaults to false, which means values are exclusive, i.e., allowed values are > low and < high.' }, { Default: false, Type: 'boolean', Description: 'A boolean flag - when four parameters are provided, third parameter determines if low value is inclusive and forth parameter determines if high value is inclusive.' }] },\r\n    FilterNaN: { Function: 'FilterNaN', Parameters: [{ Default: true, Type: 'boolean', Description: 'A boolean flag that determines if infinite values should also be excluded - defaults to true.' }] },\r\n    UnwrapAngle: { Function: 'UnwrapAngle', Parameters: [{ Default: 'Degrees', Type: 'angleUnits', Description: 'Specifies the type of angle units and must be one of the following: Degrees, Radians, Grads, ArcMinutes, ArcSeconds or AngularMil - defaults to Degrees.' }] },\r\n    WrapAngle: { Function: 'WrapAngle', Parameters: [{ Default: 'Degrees', Type: 'angleUnits', Description: 'Specifies the type of angle units and must be one of the following: Degrees, Radians, Grads, ArcMinutes, ArcSeconds or AngularMil - defaults to Degrees.' }] },\r\n    Label: { Function: 'Label', Parameters: [{ Default: 'Name', Type: 'string', Description: 'Renames a series with the specified label value.' }] },\r\n};\r\n"]}