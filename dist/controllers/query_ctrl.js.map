{"version":3,"sources":["../../src/controllers/query_ctrl.js"],"names":["QueryCtrl","FunctionList","Booleans","AngleUnits","TimeUnits","WhereOperators","_","OpenHistorianDataSourceQueryCtrl","$scope","$injector","uiSegmentSrv","templateSrv","$compile","scope","compile","ctrl","target","textEditor","segments","undefined","map","a","newSegment","value","text","expandable","queryTypes","queryType","wheres","type","newOperator","newCondition","functionSegments","topNSegment","functions","orderBys","elementSegment","newPlusButton","whereSegment","filterSegment","orderBySegment","functionSegment","typingTimer","unwrapPhasorAngle","labelPhasor","overriddenDataFlags","datasource","dataFlags","queryOptions","buildFunctionArray","setTargetWithQuery","setTargetWithElements","setTargetWithText","$","on","event","children","first","string","append","length","filter","topn","where","each","element","index","list","orderby","query","panelCtrl","refresh","variableExists","replaceWithText","join","targettext","phasorSegments","phasorSegment","option","metricFindQuery","then","altSegments","data","item","sort","b","variables","unshift","name","find","x","segment","push","plusButton","html","targets","split","splice","clearTimeout","setTimeout","focus","Promise","resolve","newOperators","whereFindQuery","newFake","filterFindQuery","orderByFindQuery","orderBy","array","Object","keys","slice","func","remove","funcSeg","Function","l","fi","findIndex","Parameters","Type","Index","Default","JSON","parse","stringify","newElement","operator","param","i","j","d","toString","Description","functionValueChanged","templateUrl"],"mappings":"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","file":"query_ctrl.js","sourcesContent":["//******************************************************************************************************\r\n//  query_ctrl.js - Gbtc\r\n//\r\n//  Copyright � 2017, Grid Protection Alliance.  All Rights Reserved.\r\n//\r\n//  Licensed to the Grid Protection Alliance (GPA) under one or more contributor license agreements. See\r\n//  the NOTICE file distributed with this work for additional information regarding copyright ownership.\r\n//  The GPA licenses this file to you under the MIT License (MIT), the \"License\"; you may not use this\r\n//  file except in compliance with the License. You may obtain a copy of the License at:\r\n//\r\n//      http://opensource.org/licenses/MIT\r\n//\r\n//  Unless agreed to in writing, the subject software distributed under the License is distributed on an\r\n//  \"AS-IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. Refer to the\r\n//  License for the specific language governing permissions and limitations.\r\n//\r\n//  Code Modification History:\r\n//  ----------------------------------------------------------------------------------------------------\r\n//  11/02/2017 - Billy Ernest\r\n//       Generated original version of source code.\r\n//\r\n//******************************************************************************************************\r\n\r\nimport { QueryCtrl } from 'app/plugins/sdk'\r\nimport { FunctionList, Booleans, AngleUnits, TimeUnits, WhereOperators } from './../js/constants.js'\r\nimport './../css/query-editor.css!'\r\nimport _ from 'lodash'\r\n\r\nexport class OpenHistorianDataSourceQueryCtrl extends QueryCtrl{\r\n    constructor($scope, $injector, uiSegmentSrv, templateSrv, $compile) {\r\n        super($scope, $injector);\r\n\r\n        this.scope = $scope;\r\n        this.compile = $compile;\r\n\r\n        var ctrl = this;\r\n        this.uiSegmentSrv = uiSegmentSrv;\r\n        this.target.target = '';\r\n        this.target.textEditor = false;\r\n        this.segments = (this.target.segments == undefined ? [] : this.target.segments.map(function (a) { return ctrl.uiSegmentSrv.newSegment({ value: a.text, expandable: true }) }));\r\n        this.queryTypes = [\r\n            \"Element List\", \"Filter Expression\", \"Text Editor\"/*, \"Phasor List\"*/\r\n        ];\r\n        this.queryType = (this.target.queryType == undefined ? \"Element List\" : this.target.queryType);\r\n        this.wheres = (this.target.wheres == undefined ? [] : this.target.wheres.map(function (a) {\r\n            if (a.type == 'operator') return ctrl.uiSegmentSrv.newOperator(a.text);\r\n            else if (a.type == 'condition') return ctrl.uiSegmentSrv.newCondition(a.text);\r\n            else return ctrl.uiSegmentSrv.newSegment(a.value);\r\n        }));\r\n        this.functionSegments = (this.target.functionSegments == undefined ? [] : this.target.functionSegments);\r\n        this.topNSegment = (this.target.topNSegment == undefined ? null : this.target.topNSegment);\r\n        this.functions = [];\r\n        this.orderBys = (this.target.orderBys == undefined ? [] : this.target.orderBys.map(function (a)\r\n        {\r\n            if (a.type == 'condition')\r\n                return ctrl.uiSegmentSrv.newCondition(a.value);\r\n            else\r\n                return ctrl.uiSegmentSrv.newSegment(a.value);\r\n        }));\r\n        this.elementSegment = this.uiSegmentSrv.newPlusButton();\r\n        this.whereSegment = this.uiSegmentSrv.newPlusButton();\r\n        this.filterSegment = (this.target.filterSegment == undefined ? this.uiSegmentSrv.newSegment('ActiveMeasurement') : this.uiSegmentSrv.newSegment(this.target.filterSegment.value));\r\n        this.orderBySegment =  this.uiSegmentSrv.newPlusButton();\r\n        this.functionSegment = this.uiSegmentSrv.newPlusButton();\r\n        this.typingTimer;\r\n        \r\n        this.target.unwrapPhasorAngle = (this.target.unwrapPhasorAngle == undefined ? false : this.target.unwrapPhasorAngle);\r\n        this.target.labelPhasor = (this.target.labelPhasor == undefined ? true : this.target.labelPhasor);\r\n\r\n        ctrl.target.overriddenDataFlags = (ctrl.target.overriddenDataFlags != undefined ? ctrl.target.overriddenDataFlags : ctrl.datasource.dataFlags);\r\n\r\n        ctrl.target.queryOptions = {};\r\n\r\n        this.buildFunctionArray();\r\n\r\n        if (this.queryType == 'Filter Expression')\r\n            this.setTargetWithQuery();\r\n        else if (this.queryType == 'Element List')\r\n            this.setTargetWithElements();\r\n        else\r\n            this.setTargetWithText();\r\n\r\n\r\n        $('panel-editor-tab .gf-form-group .gf-form-inline a.gf-form-label:contains(\"Options\")').on('click', function (event) {\r\n            if ($($('panel-editor-tab .gf-form-group div')[6]).children().first()[0] != $('query-troubleshooter')[0]) {\r\n                var string = '<query-options flags=\"ctrl.target.overriddenDataFlags\" return=\"ctrl.target.queryOptions\"></query-options>';\r\n                $($('panel-editor-tab .gf-form-group div')[6]).children().first().append(ctrl.compile(string)(ctrl.scope))\r\n            }\r\n\r\n        });\r\n\r\n    }\r\n\r\n  // #region Target Compilation\r\n    setTargetWithQuery() {\r\n        if (this.wheres.length == 0) return;\r\n        var filter = this.filterSegment.value + ' ';\r\n        var topn = (this.topNSegment ? 'TOP ' + this.topNSegment + ' ' : '');\r\n        var where = 'WHERE ';\r\n      \r\n        _.each(this.wheres, function (element, index, list) {\r\n            where += element.value + ' '\r\n        });\r\n\r\n        var orderby = '';\r\n        _.each(this.orderBys, function (element, index, list) {\r\n            orderby += (index == 0 ? 'ORDER BY ' : '') + element.value + (element.type == 'condition' && index < list.length - 1? ',' : '') +' ';\r\n        });\r\n\r\n        var query = 'FILTER ' + topn + filter + where + orderby;\r\n        var functions = '';\r\n\r\n        _.each(this.functions, function (element, index, list) {\r\n            if (element.value == 'QUERY') functions += query;\r\n            else functions += element.value;\r\n        });\r\n\r\n        this.target.target = (functions != \"\" ? functions : query);\r\n        this.target.topNSegment = this.topNSegment;\r\n        this.target.filterSegment = this.filterSegment;\r\n        this.target.orderBys = this.orderBys;\r\n        this.target.wheres = this.wheres;\r\n        this.target.functionSegments = this.functionSegments;\r\n        this.target.queryType = this.queryType;\r\n        this.panelCtrl.refresh()\r\n\r\n    }\r\n\r\n  setTargetWithElements() {\r\n      var functions = '';\r\n      var ctrl = this;\r\n      _.each(ctrl.functions, function (element, index, list) {\r\n          if (element.value == 'QUERY') functions += ctrl.segments.map(function (a) {\r\n              if (ctrl.datasource.templateSrv.variableExists(a.text)) {\r\n                  return ctrl.datasource.templateSrv.replaceWithText(a.text);\r\n              }\r\n              else\r\n                  return a.value\r\n          }).join(';')\r\n          else if (ctrl.datasource.templateSrv.variableExists(element.value)) functions += ctrl.datasource.templateSrv.replaceWithText(element.text);\r\n          else functions += element.value;\r\n      });\r\n\r\n      ctrl.target.target = (functions != \"\" ? functions : ctrl.segments.map(function (a) {\r\n          if (ctrl.datasource.templateSrv.variableExists(a.text)) {\r\n                return ctrl.datasource.templateSrv.replaceWithText(a.text);\r\n          }\r\n          else\r\n            return a.value\r\n      }).join(';'));\r\n\r\n      ctrl.target.functionSegments = ctrl.functionSegments;\r\n      ctrl.target.segments = ctrl.segments;\r\n      ctrl.target.queryType = ctrl.queryType;\r\n      ctrl.panelCtrl.refresh()\r\n\r\n  }\r\n\r\n  setTargetWithText() {\r\n      this.target.target = this.target.targettext;\r\n      this.panelCtrl.refresh(); // Asks the panel to refresh data.\r\n  }\r\n  // #endregion\r\n\r\n  onChangeInternal() {\r\n    this.panelCtrl.refresh(); // Asks the panel to refresh data.\r\n  }\r\n\r\n  // used to change the query type from element list to filter expression\r\n  changeQueryType() {\r\n      if (this.queryType != 'Text Editor') {\r\n          this.target.target = '';\r\n          this.segments = [];\r\n          this.wheres = [];\r\n          this.functions = [];\r\n          this.functionSegments = [];\r\n          this.orderBys = [];\r\n          this.topNSegment = '';\r\n          this.phasorSegments = [];\r\n          this.phasorSegment = this.uiSegmentSrv.newPlusButton();\r\n          this.elementSegment = this.uiSegmentSrv.newPlusButton();\r\n          this.whereSegment = this.uiSegmentSrv.newPlusButton();\r\n          this.filterSegment = this.uiSegmentSrv.newSegment('ActiveMeasurements');\r\n          this.orderBySegment = this.uiSegmentSrv.newPlusButton();\r\n          this.functionSegment = this.uiSegmentSrv.newPlusButton();\r\n          this.panelCtrl.refresh(); // Asks the panel to refresh data.\r\n\r\n      }\r\n      else {\r\n          this.target.targettext = this.target.target;\r\n          this.setTargetWithText();\r\n      }\r\n\r\n\r\n  }\r\n\r\n\r\n  // #region Elements\r\n  getElementSegments(newSegment) {\r\n      var ctrl = this;\r\n      var option = null;\r\n      if (event.target.value != \"\") option = event.target.value; \r\n\r\n    return this.datasource.metricFindQuery(option).then( data => {\r\n        var altSegments = _.map(data, item => {\r\n            return ctrl.uiSegmentSrv.newSegment({value: item.text, expandable: item.expandable})\r\n        });\r\n        altSegments.sort((a,b)=>{           \r\n          if(a.value < b.value)\r\n            return -1;\r\n          if(a.value > b.value)\r\n            return 1;\r\n          return 0;\r\n        });\r\n\r\n        _.each(ctrl.datasource.templateSrv.variables, (item, index, list) => {\r\n            if(item.type == \"query\")\r\n                altSegments.unshift(ctrl.uiSegmentSrv.newCondition('$' + item.name));\r\n        });\r\n\r\n        if(!newSegment)\r\n            altSegments.unshift(ctrl.uiSegmentSrv.newSegment('-REMOVE-'));\r\n\r\n        return _.filter(altSegments, segment => {\r\n          return _.find(ctrl.segments, x => {\r\n            return x.value == segment.value\r\n          }) == undefined;\r\n        });\r\n    });\r\n    \r\n  }\r\n\r\n  addElementSegment(){\r\n          // if value is not empty, add new attribute segment\r\n    if (event.target.text != null) {\r\n        this.segments.push(this.uiSegmentSrv.newSegment({ value: event.target.text, expandable: true}))\r\n      this.setTargetWithElements()\r\n    }\r\n\r\n    // reset the + button\r\n    var plusButton = this.uiSegmentSrv.newPlusButton()\r\n    this.elementSegment.value = plusButton.value\r\n    this.elementSegment.html = plusButton.html\r\n    this.panelCtrl.refresh()\r\n\r\n  }\r\n\r\n  segmentValueChanged(segment, index) {\r\n    if(segment.value== \"-REMOVE-\"){\r\n      var targets = this.target.target.split(';');\r\n      this.segments.splice(index, 1);\r\n      targets.splice(index, 1);\r\n      this.target.target = targets.join(';');\r\n    }\r\n    else{\r\n      var targets = this.target.target.split(';');\r\n      this.segments[index] = segment;\r\n      targets[index] = segment.value;\r\n      this.target.target = targets.join(';');\r\n    }\r\n    \r\n    \r\n  }\r\n  // #endregion\r\n\r\n  // #region TOP N\r\n  topNValueChanged() {\r\n      var ctrl = this;\r\n\r\n      clearTimeout(ctrl.typingTimer);\r\n      ctrl.typingTimer = setTimeout(function () { ctrl.setTargetWithQuery() }, 1000);\r\n      event.target.focus()\r\n\r\n  }\r\n  // #endregion\r\n\r\n  // #region Wheres\r\n  getWheresToEdit(where, index) {\r\n\r\n      if (where.type === 'operator') {\r\n          return Promise.resolve(this.uiSegmentSrv.newOperators(WhereOperators));\r\n      }\r\n      else if (where.type === 'value') {\r\n          return Promise.resolve(null);\r\n      }\r\n      else if (where.type === 'condition') {\r\n          return Promise.resolve([this.uiSegmentSrv.newCondition('AND'), this.uiSegmentSrv.newCondition('OR')]);\r\n      }\r\n      else {\r\n          return this.datasource.whereFindQuery(this.filterSegment.value).then(data => {\r\n              var altSegments = _.map(data, item => {\r\n                  return this.uiSegmentSrv.newSegment({ value: item.text, expandable: item.expandable })\r\n              });\r\n              altSegments.sort((a, b) => {\r\n                  if (a.value < b.value)\r\n                      return -1;\r\n                  if (a.value > b.value)\r\n                      return 1;\r\n                  return 0;\r\n              });\r\n              altSegments.unshift(this.uiSegmentSrv.newSegment('-REMOVE-'));\r\n              return _.filter(altSegments, segment => {\r\n                  return _.find(this.segments, x => {\r\n                      return x.value == segment.value\r\n                  }) == undefined;\r\n              });\r\n          });\r\n      }\r\n\r\n  }\r\n\r\n  whereValueChanged(where, index) {\r\n\r\n      if (where.value == \"-REMOVE-\") {\r\n          if (index == 0 && this.wheres.length > 3 && this.wheres[index + 3].type == 'condition') \r\n              this.wheres.splice(index, 4)\r\n          else if (index > 0 && this.wheres[index - 1].type == 'condition')\r\n              this.wheres.splice(index - 1, 4)\r\n          else\r\n              this.wheres.splice(index, 3)\r\n      }\r\n\r\n      if (where.type == 'operator')\r\n          this.wheres[index] = this.uiSegmentSrv.newOperator(where.value)\r\n      else if (where.type == 'condition')\r\n          this.wheres[index] = this.uiSegmentSrv.newCondition(where.value)\r\n\r\n      this.setTargetWithQuery();\r\n  }\r\n\r\n  getWheresToAddNew() {\r\n      var ctrl = this;\r\n      return this.datasource.whereFindQuery(ctrl.filterSegment.value).then(data => {\r\n          var altSegments = _.map(data, item => {\r\n              return ctrl.uiSegmentSrv.newSegment({ value: item.text, expandable: item.expandable })\r\n          });\r\n          altSegments.sort((a, b) => {\r\n              if (a.value < b.value)\r\n                  return -1;\r\n              if (a.value > b.value)\r\n                  return 1;\r\n              return 0;\r\n          });\r\n          return _.filter(altSegments, segment => {\r\n              return _.find(ctrl.segments, x => {\r\n                  return x.value == segment.value\r\n              }) == undefined;\r\n          });\r\n      });\r\n  }\r\n\r\n  addWhere() {\r\n      if (this.wheres.length > 0) \r\n          this.wheres.push(this.uiSegmentSrv.newCondition('AND'));\r\n\r\n      this.wheres.push(this.uiSegmentSrv.newSegment(event.target.text));\r\n      this.wheres.push(this.uiSegmentSrv.newOperator('NOT LIKE'));\r\n      this.wheres.push(this.uiSegmentSrv.newFake(\"''\", 'value', 'query-segment-value'));\r\n\r\n      // reset the + button\r\n      var plusButton = this.uiSegmentSrv.newPlusButton()\r\n      this.whereSegment.value = plusButton.value\r\n      this.whereSegment.html = plusButton.html\r\n      this.setTargetWithQuery();\r\n\r\n  }\r\n\r\n  // #endregion\r\n\r\n  // #region Filters\r\n  getFilterToEdit() {\r\n      var ctrl = this;\r\n      return this.datasource.filterFindQuery().then(data => {\r\n          var altSegments = _.map(data, item => {\r\n              return ctrl.uiSegmentSrv.newSegment({ value: item.text, expandable: item.expandable })\r\n          });\r\n          altSegments.sort((a, b) => {\r\n              if (a.value < b.value)\r\n                  return -1;\r\n              if (a.value > b.value)\r\n                  return 1;\r\n              return 0;\r\n          });\r\n\r\n          return _.filter(altSegments, segment => {\r\n              return _.find(ctrl.segments, x => {\r\n                  return x.value == segment.value\r\n              }) == undefined;\r\n          });\r\n      });\r\n  }\r\n\r\n  filterValueChanged() {\r\n      //this.target.policy = this.topNSegment;\r\n      this.orderBySegment = this.uiSegmentSrv.newPlusButton();\r\n      this.wheres = [];\r\n      this.setTargetWithQuery();\r\n\r\n      this.panelCtrl.refresh();\r\n  }\r\n\r\n  // #endregion\r\n\r\n  // #region OrderBys\r\n  getOrderBysToAddNew() {\r\n      var ctrl = this;\r\n      return this.datasource.orderByFindQuery(ctrl.filterSegment.value).then(data => {\r\n          var altSegments = _.map(data, item => {\r\n              return ctrl.uiSegmentSrv.newSegment({ value: item.text, expandable: item.expandable })\r\n          });\r\n          altSegments.sort((a, b) => {\r\n              if (a.value < b.value)\r\n                  return -1;\r\n              if (a.value > b.value)\r\n                  return 1;\r\n              return 0;\r\n          });\r\n\r\n          return _.filter(altSegments, segment => {\r\n              return _.find(ctrl.orderBys, x => {\r\n                  return x.value == segment.value\r\n              }) == undefined;\r\n          });\r\n      });\r\n  }\r\n\r\n  getOrderBysToEdit(orderBy) {\r\n      var ctrl = this;\r\n      if (orderBy.type == 'condition') return Promise.resolve([this.uiSegmentSrv.newCondition('ASC'), this.uiSegmentSrv.newCondition('DESC')]);\r\n      if (orderBy.type == 'condition') return Promise.resolve([this.uiSegmentSrv.newCondition('ASC'), this.uiSegmentSrv.newCondition('DESC')]);\r\n\r\n      return this.datasource.orderByFindQuery(ctrl.filterSegment.value).then(data => {\r\n          var altSegments = _.map(data, item => {\r\n              return ctrl.uiSegmentSrv.newSegment({ value: item.text, expandable: item.expandable })\r\n          });\r\n          altSegments.sort((a, b) => {\r\n              if (a.value < b.value)\r\n                  return -1;\r\n              if (a.value > b.value)\r\n                  return 1;\r\n              return 0;\r\n          });\r\n\r\n          if (orderBy.type !== 'plus-button')\r\n              altSegments.unshift(this.uiSegmentSrv.newSegment('-REMOVE-'));\r\n\r\n          return _.filter(altSegments, segment => {\r\n              return _.find(ctrl.orderBys, x => {\r\n                  return x.value == segment.value\r\n              }) == undefined;\r\n          });\r\n      });\r\n  }\r\n\r\n  addOrderBy() {\r\n      this.orderBys.push(this.uiSegmentSrv.newSegment(event.target.text));\r\n      this.orderBys.push(this.uiSegmentSrv.newCondition('ASC'));\r\n\r\n      // reset the + button\r\n      var plusButton = this.uiSegmentSrv.newPlusButton()\r\n      this.orderBySegment.value = plusButton.value\r\n      this.orderBySegment.html = plusButton.html\r\n\r\n      this.setTargetWithQuery();\r\n\r\n      if (this.queryType == 'Filter Expression')\r\n          this.setTargetWithQuery();\r\n      else\r\n          this.setTargetWithElements()\r\n\r\n  }\r\n\r\n\r\n  orderByValueChanged(orderBy, index) {\r\n      if (event.target.text == \"-REMOVE-\")\r\n          this.orderBys.splice(index, 2);\r\n      else\r\n      {\r\n          if (orderBy.type == 'condition')\r\n              this.orderBys[index] = this.uiSegmentSrv.newCondition(event.target.text);\r\n          else\r\n              this.orderBys[index] = this.uiSegmentSrv.newSegment(event.target.text);\r\n\r\n      }\r\n      this.setTargetWithQuery();\r\n\r\n  }\r\n\r\n  // #endregion\r\n\r\n  // #region Functions\r\n  getFunctionsToAddNew() {\r\n      var ctrl = this;\r\n      var array = []\r\n      _.each(Object.keys(FunctionList), function (element, index, list) {\r\n          array.push(ctrl.uiSegmentSrv.newSegment(element));\r\n      });\r\n\r\n      if (this.functions.length == 0) array = array.slice(2,array.length);\r\n\r\n      return Promise.resolve(_.filter( array, segment => {\r\n          return _.find(this.functions, x => {\r\n              return x.value == segment.value;\r\n          }) == undefined;\r\n      }));\r\n  }\r\n\r\n  getFunctionsToEdit(func, index) {\r\n      var ctrl = this;\r\n      var remove = [this.uiSegmentSrv.newSegment('-REMOVE-')];\r\n      if (func.type == 'Operator') return Promise.resolve();\r\n      else if (func.value == 'Set') return Promise.resolve(remove)\r\n\r\n      return Promise.resolve(remove);\r\n  }\r\n\r\n  functionValueChanged(func, index) {\r\n      var funcSeg = FunctionList[func.Function];\r\n\r\n      if (func.value == \"-REMOVE-\") {\r\n          var l = 1;\r\n          var fi = _.findIndex(this.functionSegments, function (segment) { return segment.Function == func.Function });\r\n          if (func.Function == 'Slice')\r\n              this.functionSegments[fi + 1].Parameters = this.functionSegments[fi + 1].Parameters.slice(1, this.functionSegments[fi + 1].Parameters.length);\r\n          else if (fi > 0 && (this.functionSegments[fi - 1].Function == 'Set' || this.functionSegments[fi - 1].Function == 'Slice')) {\r\n              --fi;\r\n                ++l;\r\n          }\r\n\r\n          this.functionSegments.splice(fi,l);\r\n      }\r\n      else if (func.Type != 'Function') {\r\n          var fi = _.findIndex(this.functionSegments, function (segment) { return segment.Function == func.Function });\r\n          this.functionSegments[fi].Parameters[func.Index].Default = func.value;\r\n      }\r\n\r\n      this.buildFunctionArray()\r\n\r\n      if (this.queryType == 'Filter Expression')\r\n          this.setTargetWithQuery();\r\n      else\r\n          this.setTargetWithElements() \r\n\r\n  }\r\n\r\n  addFunctionSegment() {\r\n      var func = FunctionList[event.target.text];\r\n\r\n      if (func.Function == 'Slice') {\r\n          this.functionSegments[0].Parameters.unshift(func.Parameters[0])\r\n      }\r\n\r\n      this.functionSegments.unshift(JSON.parse(JSON.stringify(func)));\r\n      this.buildFunctionArray();\r\n\r\n      // reset the + button\r\n      var plusButton = this.uiSegmentSrv.newPlusButton()\r\n      this.functionSegment.value = plusButton.value\r\n      this.functionSegment.html = plusButton.html\r\n\r\n      if (this.queryType == 'Filter Expression')\r\n          this.setTargetWithQuery();\r\n      else\r\n          this.setTargetWithElements()\r\n  }\r\n\r\n  buildFunctionArray() {\r\n      var ctrl = this;\r\n      ctrl.functions = [];\r\n\r\n      if (this.functionSegments.length == 0) return;\r\n\r\n      _.each(ctrl.functionSegments, function (element, index, list) {\r\n          var newElement = ctrl.uiSegmentSrv.newSegment(element.Function)\r\n          newElement.Type = 'Function';\r\n          newElement.Function = element.Function;\r\n\r\n          ctrl.functions.push(newElement)\r\n\r\n          if (newElement.value == 'Set' || newElement.value == 'Slice') return;\r\n\r\n          var operator = ctrl.uiSegmentSrv.newOperator('(');\r\n          operator.Type = 'Operator';\r\n          ctrl.functions.push(operator);\r\n\r\n          _.each(element.Parameters, function (param, i, j) {\r\n              var d = ctrl.uiSegmentSrv.newFake(param.Default.toString());\r\n              d.Type = param.Type;\r\n              d.Function = element.Function;\r\n              d.Description = param.Description;\r\n              d.Index = i;\r\n              ctrl.functions.push(d);\r\n\r\n              var operator = ctrl.uiSegmentSrv.newOperator(',');\r\n              operator.Type = 'Operator';\r\n              ctrl.functions.push(operator);\r\n          })\r\n\r\n      });\r\n\r\n      var query = ctrl.uiSegmentSrv.newCondition('QUERY');\r\n      query.Type = 'Query';\r\n      ctrl.functions.push(query);\r\n\r\n      for (var i in ctrl.functionSegments) {\r\n          if (ctrl.functionSegments[i].Function != 'Set' && ctrl.functionSegments[i].Function != 'Slice') {\r\n              var operator = ctrl.uiSegmentSrv.newOperator(')');\r\n              operator.Type = 'Operator';\r\n              ctrl.functions.push(operator);\r\n          }\r\n\r\n      }\r\n\r\n  }\r\n\r\n  getBooleans() {    \r\n      return Promise.resolve(Booleans.map(value => { return this.uiSegmentSrv.newSegment(value)}));\r\n  }\r\n\r\n  getAngleUnits() {\r\n      return Promise.resolve(AngleUnits.map(value => { return this.uiSegmentSrv.newSegment(value) }));\r\n  }\r\n\r\n  getTimeSelect() {\r\n      return Promise.resolve(TimeUnits.map(value => { return this.uiSegmentSrv.newSegment(value) }));\r\n  }\r\n\r\n  inputChange(func, index) {\r\n      var ctrl = this;\r\n      clearTimeout(this.typingTimer);\r\n      this.typingTimer = setTimeout(function () { ctrl.functionValueChanged(func, index) }, 1000);\r\n      event.target.focus()\r\n      \r\n  }\r\n\r\n  // #endregion\r\n\r\n}\r\n\r\nOpenHistorianDataSourceQueryCtrl.templateUrl = 'partial/query.editor.html';\r\n\r\n"]}